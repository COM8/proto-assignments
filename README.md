# protocol-assignment-1

### ToDo:
* Add a way to indicate for which file the package is in the  ```File-Creation``` and ```File-Transfer``` message

### Important:
* UDP MTU

### Changelog:
* 26.04.2018 [Kilian] added Convention, added CRC and Hash,added ability to delete Files and Folders, minor optimisations
* 20.04.2018 [Fabian] Initial commit
* 22.04.2018 [Fabian] Protocol

## Convention:
* FID := Relative Path with File name (folder/file.txt)
* Client ID := Identification each client can choose

## Protocol:

### General field descriptions:
Type [4 Bit]:<br/>
	0000 => Client-Hello-Handshake<br/>
	0001 => Server-Hello-Handshake<br/>
	0010 => File-Creation<br/>
	0011 => File-Transfer<br/>
	0100 => Server-ACK<br/>

Client ID [32 Bit]:<br/>
	An unique client id generated by the server on first contact<br/>
	e.g. static filed with an int that gets incremented for each connected client

Checksum [32 Bit]:<br/>
	CRC32 Algorithm [Wiki Link](https://en.wikipedia.org/wiki/Cyclic_redundancy_check)

Sequence Number [32 bit]:<br/>
	Like TCP

### Client-Hello-Handshake:
```
0      4      20         52       56
+------+------+----------+--------+
| Type | Port | Checksum | UNUSED |
+------+------+----------+--------+
```

Port [16 Bit]:<br/>
	The port on which the client listens to server messages

UNUSED [4 Bit]:<br/>
	To ensure the package has mod 8 = 0 size

### Server-Hello-Handshake:
```
0      4       8           40            56         88
+------+-------+-----------+-------------+----------+
| Type | Flags | Client ID | Upload-port | Checksum |
+------+-------+-----------+-------------+----------+
```
Upload-port [16 Bit]:<br/>
	The Port where the client should send all following messages to

Flags [4 Bit]:
```
0000
||||
|||+-> Client accepted
||+--> Too many clients - connection revoked
|+---> *UNUSED*
+----> *UNUSED*
```

### File-Creation:
```
0      4           36                68          70					
+------+-----------+-----------------+-----------+------------------+-----------+
| Type | Client ID | Sequence Number | File Type | File Name Length | File Name |
+------+-----------+-----------------+-----------+------------------+-----------+
+----------+----------+
| SHA3 256 | Checksum |
+----------+----------+
```

File Type [2 Bit]:<br/>
	00 => Folder<br/>
	01 => File<br/>
	10 => Delete File<br/>
	11 => Delete Folder<br/>

FID Length [x Bit] **Don't forget about the MTU**

FID [defined in "File Name Length" in Bit]:
	With relative Path


### File-Transfer:
```
0      4           36                68      72
+------+-----------+-----------------+-------+----------------+---------+----------+
| Type | Client ID | Sequence Number | Flags | Content Length | Content | Checksum |
+------+-----------+-----------------+-------+----------------+---------+----------+
```

Flags [4 Bit]:
```
0000
||||
|||+-> First package for the given file
||+--> File content
|+---> *UNUSED*
+----> Last package for the file
```

Content Length [x Bit] **Don't forget about the MTU**

Content [defined in "Content Length" in Bit] **Don't forget about the MTU**

### Server-ACK:
```
0      4           36                    68
+------+-----------+---------------------+
| Type | Client ID | ACK Sequence Number |
+------+-----------+---------------------+
```

ACK Sequence Number [like Sequence Number]:<br/>
	The acknowledged sequence number

### Transfer-Ended:
```
0      4       8           40         72
+------+-------+-----------+----------+
| Type | Flags | Client ID | Checksum |
+------+-------+-----------+----------+
```

Flags [4 Bit]:
```
0000
||||
|||+-> Transfer finished
||+--> Cancelled by user
|+---> Error
+----> *UNUSED*
```

## Process example:

```
      Client				  Server
	|	Client-Hello-Handshake	    |
	| --------------------------------> | The clients starts the connection on the default port
	|				    | and tells the server the port on which he listens for answers
	|	Server-Hello-Handshake      |
	| <-------------------------------- | The server responds with a client ID and a port where the
	|				    | server is listening for incoming transfer messages
	|	File-Creation		    |
	| --------------------------------> | The client sends this message to inform the server about
	|				    | the new file that will be transferred
	|	Server-ACK  		    |
	| <-------------------------------- |
	|				    |
	|	File-Transfer		    |
	| --------------------------------> | The client starts sending the file
	|				    |
	|	File-Transfer		    |
	| --------------------------------> |
	|				    |
	|	File-Transfer		    |
	| --------------------------------> |
	|				    |
	|	File-Transfer		    |
	| --------------------------------> |
	|				    |
	|	Server-ACK  		    |
	| <-------------------------------- | The server sends an ACK message for each message
	|				    | it received from the client
	|	Server-ACK  		    |
	| <-------------------------------- |
	|				    |
	|	Server-ACK  		    |
	| <-------------------------------- |
	|				    |
	|	Transfer-Ended		    |
	| --------------------------------> | The client tells the server that the transfer finished
```
